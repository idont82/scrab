<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>33m2 scrab</title>
  
	<!-- https://getbootstrap.kr/ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css" />
	<script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
	
	<script src="/js/common.js"></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9914349640032484"
     crossorigin="anonymous"></script>
    
    <style>
    </style>
</head>

<body>
	
	<div class="container mt-3">
	  	
	  	<div class="row g-3 align-items-center">
	  		
	  		<div class="col-auto">
	  			<div class="input-group ">
					<label class="input-group-text" for="inputGroupSelect01">날짜</label>
					<select id="sel_month" class="form-select" id="inputGroupSelect01">
					</select>
				</div>
				
			</div>
			
		  	<div class="col-auto">
		  		<div class="input-group ">
					<label class="input-group-text" for="inputGroupSelect02">지역</label>
					<select id="sel_area" class="form-select" id="inputGroupSelect02">
						<option value="None">선택...</option>
						<option value="서울">서울</option>
						<option value="경기">경기</option>
						<option value="강남">강남</option>
						<option value="홍대">홍대</option>
						<option value="인천">인천</option>
						<option value="제주도">제주도</option>
						<option value="부산">부산</option>
					</select>
				</div>
			</div>
	
		</div>
		
		<table id="myTable" class="display">
		    <thead>
		    </thead>
		    <tbody>
		    </tbody>
		</table>

	</div>

  
	
    <script>
    
    $(document).ready(function() {
    	
    	//1) 날짜 담기
    	const currentDate = new Date();
        const recentMonths = $('#sel_month');

        for (let i = 0; i < 3; i++) {
          const month = currentDate.getMonth() - i;
          const year = currentDate.getFullYear();
          const formattedMonth = (month + 1).toString().padStart(2, '0'); // 1자리 월을 2자리로 표시
          const formattedYear = year.toString();

          const dateString = `${formattedYear}_${formattedMonth}`;

          // option 태그 생성
          const option = $('<option>');
          option.val(dateString);
          option.text(`${formattedYear}-${formattedMonth}`);
          recentMonths.append(option);
        }
        
        recentMonths.change(function() {

            var selectedValue = $(this).val();
            //alert('선택된 값: ' + selectedValue);
            select();
        });
        
        
        //2) 지역
        const recentAreas = $('#sel_area');
        recentAreas.change(function() {

            var selectedValue = $(this).val();
            //alert('선택된 값: ' + selectedValue);
            select();
        });
            
        
        //4)조회
        select();
    	
    });
    
    
    select = function(){
	
    	var pArea = $('#sel_area').val();
    	var pMonth = $('#sel_month').val();
		
    	let url = '../json/' +pArea+ '_'+ pMonth +'.json';
    	
    	if(pArea == "None"){
    		url = '../json/' +pArea+'.json';
    	}
    	
    	let columns =[
    		//{ data: null, title : "Num." },
    		{ data: 'rid', title :"RID" },
	        { data: 'town' , title : "동/리"},
	     
	        { data: 'addr_lot' , title :"주소" },
	        { data: 'using_fee', title :"가격" , type:"num" },
	        { data: 'last_date', title :"업데이트"  }
	    ]
    	const MONTH_CNT = 3; //3개월
    	    	
    	for(var i=0; i<MONTH_CNT;i++){
    		let now = new Date();
    		let later = new Date( now.setMonth(now.getMonth() + i) );
    		let dateFormat = later.getFullYear() + '-' + ( (later.getMonth()+1) < 9 ? "0" + (later.getMonth()+1) : (later.getMonth()+1) );
    		let dateFormatNm = dateFormat.replaceAll("-","") +"_cnt" ;
    		
    		columns.push( { data: dateFormatNm, title : dateFormat } ); 
		}
    	
    
	    $('#myTable').DataTable( {
	    	order: [[5, 'desc'],[6, 'desc'],[7, 'desc']],
	    	layout: {
	            topStart: {
	                pageLength: {
	                    menu: [100, 300, 500, 1000, 2000, 3000, 4000, 5000]
	                }
	            },
	        },
	        pageLength: 500,
	        destroy: true,
	    	paging: true,
	        ajax: { url : url, dataSrc : ''},
		    columns: columns,
		    columnDefs: [
		    	{ targets: 3 , render: $.fn.dataTable.render.number( ',' ) },
		    	//{ targets: 0,  data: null,  render: function (data, type, row, meta) {  return meta.row + 1;  }  }
		      ]
	    } );
	    
    };
    
    </script>
</body>

</html>